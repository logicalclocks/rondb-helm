apiVersion: v1
kind: Secret
metadata:
  name: {{ include "rondb.mysql.usersSecretName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    type: generated-password
{{- $secret := lookup "v1" "Secret" .Release.Namespace (include "rondb.mysql.usersSecretName" .) }}
data:
   {{- $users := list "root" .Values.benchmarking.mysqlUsername }}
   {{- if and .Values.global .Values.global._hopsworks }}
   {{- $users = append $users (include "hopsworkslib.mysql.hopsworksRootUser" .) }}
   {{- end }}
   {{- range $user := $users}}
   {{- if and $secret (index $secret "data" $user)}}
   {{ $user }}: "{{ index $secret "data" $user }}"
   {{- else }}
   {{ $user }}: "{{- randAlphaNum 20 | b64enc -}}"
   {{- end }}
   {{- end }}